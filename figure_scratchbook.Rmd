---
title: "Figure Scratchbook"
author: "Kate Culhane"
output:
  html_document:
    theme: flatly
    highlight: tango
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      fig.width=5, fig.height=3)
```

**NOTE:** This is just a working space for ideas and static figures before I incorporate them into the Shiny app.

---


```{r packages and data}

# Packages
library(tidyverse)
library(janitor) # clean column names
library(kableExtra) # pretty tables
library(leaflet) # interactive maps
library(sf) # spatial functions

# Raw personal eBird data
ebird_dat <- read_csv('./data/MyEBirdData.csv') %>%
  clean_names()

# Observation point data
ebird_sf <- st_as_sf(ebird_dat, coords = c("longitude","latitude")) %>% 
  st_set_crs(4326) # set CRS to WGS84

```

## Notes on data

Data has one row per species per checklist.

Data cleaning to do:
- Remove observations of upper-level taxa (e.g., Buteo sp.)
- Combine observations of subspecies

## Figure ideas

- Interactive map of observations
- Histogram of times checklists are submitted - but instead of end times have it include the entire span 
- Jason's county competition
- Word map of comments
- Diversity metrics
- Map through time gif

Toggle by taxonomic groups

## Top ten most frequently observed species

```{r top ten}

# Summary table

summary <- ebird_dat %>% 
  group_by(common_name, scientific_name) %>% 
  summarize(n = length(common_name)) %>% 
  ungroup() %>% 
  arrange(-n) %>% 
  top_n(10)

kable(summary[,1:3], col.names = c("Common name", "Latin binomial", "Observations")) %>% 
  kable_styling(bootstrap_options = c('striped', 'condensed'),
                full_width = FALSE,
                position = 'left') %>% 
  column_spec(2, italic = TRUE) %>% 
  column_spec(1, width = '5cm')

```

## Interactive map

```{r interactive map}

# Interactive map
ebird_sf %>% 
  group_by(location, geometry) %>% 
  summarise(n = length(location)) %>% 
  ungroup() %>% 
  mutate(loggedn = ifelse(n==1, 0.2/log(max(n),10), # change n=1 obs
                          log(n,10)/log(max(n),10))) %>% 
  arrange(-n) %>% 
  # Make map
  leaflet() %>% 
  addProviderTiles(providers$Esri.WorldGrayCanvas) %>%  
  addCircleMarkers(
    radius = ~loggedn*12+2,
    # color = ~pal(type),
    stroke = FALSE, fillOpacity = 0.5,
    label = ~location,
    popup = ~paste0(location,"<br>Checklists: ",n)
  )

```

[Options for basemaps](https://leaflet-extras.github.io/leaflet-providers/preview/index.html)
- Esri.WorldGrayCanvas
- Esri.WorldImagery
- Esri.WorldStreetMap
- Esri.WorldPhysical
- Esri.WorldShadedRelief
